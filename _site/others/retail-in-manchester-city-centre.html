<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Retail in Manchester City Centre – Christian Spence</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Christian Spence</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../biography.html"> 
<span class="menu-text">Biography</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research-publications.html"> 
<span class="menu-text">Research &amp; Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../publications-elsewhere.html"> 
<span class="menu-text">Publications elsewhere</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://economic-analytics.co.uk"> 
<span class="menu-text">Economic Analytics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/christianspence.co.uk"> 
<span class="menu-text">bsky</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-twitter-x" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-twitter-x" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-twitter-x">    
        <li>
    <a class="dropdown-item" href="https://x.com/ChristianSpence">
 <span class="dropdown-text">Christian Spence</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://x.com/EconAnalyticsUK">
 <span class="dropdown-text">Economic Analytics</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-linkedin" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-linkedin">    
        <li>
    <a class="dropdown-item" href="https://linkedin.com/in/christianspence">
 <span class="dropdown-text">Christian Spence</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://linkedin.com/company/economic-analytics">
 <span class="dropdown-text">Economic Analytics</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/ChristianSpence">
 <span class="dropdown-text">Christian Spence</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/economic-analytics">
 <span class="dropdown-text">Economic Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ChristianSpence/christianspence.co.uk">
 <span class="dropdown-text">Website source code</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Retail in Manchester City Centre</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>This piece was first published in Greater Manchester Chamber of Commerce’s member magazine, 53 Degrees, in May 2014.</em></p>
<p>With Manchester city centre bucking the national trends and going from strength to strength, Christian Spence, Head of Business Intelligence, looks at some of the changes in the retail sector over the past few years and how Manchester has not only survived, but positively thrived.</p>
<section id="the-high-streets-decline-is-not-inevitable" class="level2">
<h2 class="anchored" data-anchor-id="the-high-streets-decline-is-not-inevitable">The high street’s decline is not inevitable</h2>
<p>There has been much talk of the death of the high street and the statistics partially bear this out with retail sales stagnating for four years from late-2007. Whilst we’ve seen a strong recovery since the middle of 2013, some high streets are still showing signs of considerable distress. However, the problems go beyond macro-economics and are more to do with a changing culture. People’s expectations have changed, and not all towns have yet understood, or been able to respond to, the change in customers’ habits.</p>
</section>
<section id="the-bad-guys" class="level2">
<h2 class="anchored" data-anchor-id="the-bad-guys">The bad guys</h2>
<p>Business rates, parking charges, out-of-town centres and the internet have all been blamed. Business rates have become more vilified with charges currently linked to rental value at the top of the market in 2008 despite some rents falling by over 50% since then. Some argue that this has given an advantage to companies who operate solely on-line.</p>
<p>Ever since London’s Brent Cross opened in 1976, there have been concerns that large centres with free parking have had a negative effect on town centres. In the 1980s, government relaxation of retail sector planning policies coupled with increased car ownership meant more people were shopping in out-of-town centres: by the early-2000s nearly half of all food purchases were from out-of-town hypermarkets.</p>
<p>The conflict between free parking at out-of-town sites and a policy to significantly increase town centre parking charges to mitigate traffic problems in city centres may have had an all too predictable effect, particularly as out-of-town sites are able to increase the volume of free parking to manage demand, a challenge that is harder to meet in urban centres.</p>
<p>The internet is a disruptive technology, changing the face of entire industries in the blink of an eye. The share of internet sales is increasing at around 10% per year; 12% of all retail sales are now online and, for some segments, that share increases to over 60%. Even areas such as clothes and food are now seeing strong growth. Some businesses have balanced the “bricks and clicks” and see them as complementary to their high street presence showing that success in the internet age is possible, providing you get the business model right.</p>
</section>
<section id="agglomerations-mostly-what-you-need" class="level2">
<h2 class="anchored" data-anchor-id="agglomerations-mostly-what-you-need">Agglomeration’s (mostly) what you need</h2>
<p>Back in 2007, the British Council of Shopping Centres noted “… smaller town centres have not only been affected by out-of-town development but have also suffered the impact of the concentration of development within larger town centres.” This is crucially important. The recession exacerbated an existing problem, but it is the consumer that is driving the change in the retail world.</p>
<p>Shopping has become less of a refuel and restock process and has evolved into a complex mix where the boundaries of retail, tourism and leisure merge. The public seeks a wider experience and the places that benefit the most are those that provide it, merging shopping, eating and drinking, entertainment and wider visitor attractions into a single user journey.</p>
<p>There are exceptions: some smaller village centres are thriving. Places which offer a smaller-scale, bespoke service, focused on locality, individuality and often a non-corporate nature can do particularly well, and Greater Manchester has a number of these successful, smaller centres. Essentially, high street retail has been subject to the same forces as other businesses over the past decade: success can be found in high-volume, relatively low-margin and low cost stores and in lower-volume, higher-margin specialists who have a personal offer, but those in between are being ruthlessly squeezed.</p>
<p>Some music stores in the UK were driven out both by iTunes and by smaller, specialist music and record stores; Tesco is feeling the pressure from Aldi and Lidl at the bottom, and Waitrose at the top. Appealing to everyone is hard for a single institution, but it’s possible in for a large agglomerative city centre to offer all the alternatives to suit everyone’s taste.</p>
<p>Manchester is undoubtedly one of those larger centres that has thrived and is well placed to take advantage of the recovery. To help embed that success, and build further upon it, it formed a new group to help it through.</p>
</section>
<section id="the-manchester-visitor-economy" class="level2">
<h2 class="anchored" data-anchor-id="the-manchester-visitor-economy">The Manchester Visitor Economy</h2>
<p>The wider tourism sector generates around £6 billion to the city region and the retail spend within the city centre alone amounts to £1.2 billion. Add the Intu Trafford Centre into that and our two key shopping areas account for around one pound in every three spent in retail across the whole of the North West. Manchester is the best performing city centre in the UK outside London with its regular commuters, workers and residents accounting for 40% of all spending. The changing demographics of the city with increasing numbers of people, particularly students and young professionals now living in the city centre means there is a larger captive audience who could be successfully engaged with the leisure provision, and it is partially this population that Manchester wanted to target more effectively in a new scheme.</p>
</section>
<section id="heart-of-manchester-bid" class="level2">
<h2 class="anchored" data-anchor-id="heart-of-manchester-bid">Heart of Manchester BID</h2>
<p>After consulting over 300 city centre retailers, in November 2012 a successful vote brought into being a five-year initiative: the Heart of Manchester Business Improvement District (BID). At the end of the BID’s first year, it is good to take stock of why it was set-up and what it hoped to achieve, reflecting on its first year and the challenges that lie ahead.</p>
<p>The BID’s primary objectives are to launch major new events in the city centre to attract footfall, develop a city centre hosts scheme to help and support visitors, cultivate a stream of activity to boost midweek and evening trade and to deliver significant promotional campaigns and partnerships to attract more affluent shoppers. These were designed to increase the overall attractiveness of the city centre to shoppers – both existing users and new visitors – repeat visits and provide a direct and tangible return on investment.</p>
<p>Increasing opening hours of the city centre stores and bringing new events into the city centre was seen as particularly crucial. When Manchester introduced late-night opening on Thursdays in 2005, it was clear there was demand, particularly from those who work and spend the day in the city, to stay into the evening for shopping and other activities. On other evenings, however, the city virtually closed at five o’clock. Simon Binns, manager of the Heart of Manchester BID, says: “the extended opening times of many of the city centre retailers through until eight o’clock has transformed the feel of the city in the evenings. Manchester now has a vibrant after-work culture in shops and bars every night of the week: it’s not just confined to say, a Thursday or Friday night. Today, the core retail areas are seeing significantly higher footfall and the city feels a much more vibrant area after work. Before this important commitment from retailers, Manchester suffered by seeing many of its 140,000 city centre employees head home straight after work, taking their discretionary spend with them. But now we’re seeing them not only stay in the evenings but return at the weekends with a significant increase in people coming into the city on Sundays, causing some retailers to look at staying open longer until 6pm. Capturing these additional visits gives Manchester a very different flavour: more cosmopolitan, more vibrant, a place to not just work or shop, but also linger and enjoy.”</p>
<p>But it takes more than just extended opening hours for shopping to convince people that staying after work is worth it. Manchester has its fair share of events, from the world-leading Manchester International and Jazz Festivals, the immensely successful Christmas Markets, as well as numerous smaller events, often located around the Town Hall on Albert Square, an area not synonymous with the city centre retail sector.</p>
<p>The near one million pounds raised each year through the participating members of the BID has gone a long way to delivering additional attractions. The first major event the BID helped to deliver was Dig the City, a new urban gardening festival pioneered by the Cathedral, in August 2013. With support from the National Trust, the City Council, Groundwork and the Co-operative Group’s NOMA, the traditionally quieter time in the retail calendar over summer counted over an additional one million visitors. The event increased footfall by over a quarter in New Cathedral Street and King Street and the city centre as a whole by more than 5% with half of all visitors doing additional shopping whilst there. Its success was deemed so strong that plans are already well advanced for a repeat of this nine-day event this year.</p>
<p>October saw Manchester turned into a catwalk with Vogue Fashion’s Night Out coming to the city for the first time. Over 160 of the city centre’s retailers took part with thousands of visitors flocking not only to the direct events but also to extra late-night opening in the participating stores, doubling the footfall normally seen. What’s particularly important about events like this is that visitors are not constrained purely to the event venues themselves, but engage with the wider city centre proposition. During the Vogue fashion events, Manchester Arndale saw a 22% increase in footfall with 120,000 people using the centre on the main night.</p>
<p>Manchester Arndale understands the wider benefit that these big-piece city centre events have on its and its occupants’ fortunes. It is working closely with the BID team to ensure that it, too, is closely involved in the wider strategy. Featured in this month’s Behind the Scenes on pages 12-14, Manchester Arndale has done well through the recession and visitor numbers keep increasing with 2013 recording the second year in a row with over 41 million.</p>
<p>The centre is currently planning its annual October student event for the 11th year, focused around the new intake of students at the city’s universities. David Allinson, Centre Director at Manchester Arndale, takes up the story. “We’re home to Europe’s largest student population of around 100,000 and they can be seen as key to the success of the city centre, with one in five of our visitors being students. Changing demographics, such as many more international students with a higher spend profile and a desire to get to know everything that Manchester offers from a global viewpoint, means they are becoming ever more important to the city’s fortunes.</p>
<p>“Our recent student spring event was hugely successful with live music, DJs and exclusive retailer offers. Alongside the October event we’re developing new ways of engaging the student population, particularly when students bring their wider families to the city to visit, such as through offers and social media. This is particularly important for international visitors as their spend profile is significantly higher.”</p>
<p>Alongside this targeted engagement from retailers, the BID team is developing a user-friendly guide to the city and its shops, bars, theatres and museums, to make international family visits as easy and smooth as possible.</p>
<p>David added, “Working integrally with the Heart of Manchester BID team is key to us and I think that the successes of the BID in its inaugural year demonstrates how bringing Manchester’s retailers together serves the city centre very well. We have worked closely with the BID to deliver hugely successful and profitable Vogue Fashion’s Night Out activity, as well as seasonal celebrations such as Chinese New Year and St Patrick’s Day and we have been thrilled by the results in terms of footfall and visitor engagement.”</p>
<p>The benefits don’t just flow to the bigger stores: small businesses benefit too. Manchester is home to a thriving independent retail sector (18% of all city centre businesses) – the largest share outside London. They benefit from the much higher footfall figures so the winnings are not just for the larger, paying members of the BID.</p>
<p>This was highlighted in the larger Chinese New Year celebrations of February 2014. With the city covered in 3,000 Chinese lanterns and special food markets across the city, the event was a showcase for Manchester’s long-established Chinese community. With visitor numbers up 20% on the previous year, city centre retailers saw an increase in sales of up to 125% on the main day of the festival with footfall up 59%.</p>
<p>The BID’s first year has shown what can be achieved when key partners come together to invest in the city and deliver a comprehensive offer to residents, workers and tourists alike. Retail sales and footfall have increased faster than the national average and total visitors to the city have increased by 14%. The Heart of Manchester BID has many additional events planned for its second year and beyond: for more information visit <a href="www.cityco.com/heartofmanchester"></a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>